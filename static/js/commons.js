$(document).ready(function(){var t=decodeURIComponent(window.location.origin),a=function(){window.location.href=t},i=function(){var t,a=$("#title-nav-bar .title-search input"),i=$("#search-results-list"),e=$("#title-nav-bar .title-search span"),n=function(t){t.pid?window.open("/forum/post/"+t.pid):t.id?window.open("/stock/strategy?sid="+t.id):t.uid&&window.open("/user/home?uid="+t.uid),scrat.utility.removePopup()},s=function(t,a){t[0].data_model=a,t.click(function(){n(this.data_model)}),t.mouseover(function(){i.find("li").removeClass("selected"),$(this).addClass("selected")}),t.mouseout(function(){i.find("li").removeClass("selected")})};$(a).keyup(function(e){var o=$(this).val(),l=$(this).offset();if(i.css({top:l.top+30,left:l.left}),""===o)return void i.empty().hide();if(13===e.keyCode){var r=i.find("li.selected");return void(r.length>0?n(r[0].data_model):1===$("#stock-list li").length?n($("#stock-list li")[0].data_model):window.open("/search?key="+encodeURI($(a).val())))}if(38===e.keyCode){var r=i.find("li.selected"),c=i.find("li").length,d=-1;if(0>=c)return;return r.length>0&&(d=r.index()-1),0>d&&(d=c-1),i.find("li").removeClass("selected"),void i.find("li:eq("+d+")").addClass("selected")}if(40===e.keyCode){var r=i.find("li.selected"),c=i.find("li").length,d=-1;if(0>=c)return;return r.length>0&&(d=r.index()+1),(0>d||d>=c)&&(d=0),i.find("li").removeClass("selected"),void i.find("li:eq("+d+")").addClass("selected")}clearTimeout(t),t=setTimeout(function(){scrat.utility.ajaxDispatch("GET","/search?fmt=json&s="+o+"&n=5",!1,null,function(t){i.empty(),i.append('<li class="sub-title">策略</li>');var a,e,n,o=t.data.strategy_list;if(o&&o.length>0)for(a=0,e=o.length;e>a;a++)n=$("<li>"+o[a].name+"</li>"),i.append(n),s(n,o[a]);if(i.append('<li class="sub-title">用户</li>'),o=t.data.user_list,o&&o.length>0)for(a=0,e=o.length;e>a;a++)n=$("<li>"+o[a].username+"</li>"),i.append(n),s(n,o[a]);if(i.append('<li class="sub-title">帖子</li>'),o=t.data.post_list,o&&o.length>0)for(a=0,e=o.length;e>a;a++)n=$("<li>"+o[a].title+"</li>"),i.append(n),s(n,o[a]);scrat.utility.addPopup(i)})},500)}),$(a).mouseup(function(){return this.data_model&&(this.selectionStart=0,this.selectionEnd=100),!1}).focusin(function(){this.data_model&&(this.selectionStart=0,this.selectionEnd=100)}),e.click(function(){var t=a.val();""!==t&&window.open("/search?key="+encodeURI(t))})},e=function(t){{var a=JSON.parse(t.data),i=$("#title-nav-bar").find(".ring-bell");$("#talk-status-info")}0!==a.data.new_count?(i.find(".num").text(Math.min(a.data.new_count,9)),i.find(".tip").show()):i.find(".tip").hide()},n=function(){var t=null;$(window).blur(function(){null!==t&&(t.close(),t=null)}),$(window).focus(function(){"undefined"!=typeof EventSource&&null===t&&(t=new EventSource("/msg/window"),t.onmessage=e)}),"undefined"!=typeof EventSource&&null===t&&(t=new EventSource("/msg/window"),t.onmessage=e),$("#title-nav-bar .ring-bell").click(function(){window.open("/msg"),$("#title-nav-bar .ring-bell .tip").hide()})},s=function(){scrat.initial_data.account&&"null"!==scrat.initial_data.account?(scrat.utility.isRealMobile()?($("#gr_navbar .login .txt").text("个人中心"),$("#gr_navbar .navbar-nav .logout").removeClass("hide")):$("#title-nav-bar .right-side.user").removeClass("hide"),scrat.utility.ajaxDispatch("GET","/user/profile",!0,null,function(t){scrat.utility.isRealMobile()&&t.data.avatar?($("#gr_navbar .user .avatar")[0].src=t.data.avatar,$("#gr_navbar .user .avatar").addClass("profile")):($("#title-nav-bar .user .name").text(t.data.username),$("#title-nav-bar .user .avatar").css("background-image","url("+(t.data.avatar||scrat.stockEnums.defaultProfileImg)+")"),t.data.title&&$("#title-nav-bar .vip-icon").show()),scrat.navPara.userProfile=t.data,scrat.docController&&scrat.docController.getRulePool&&scrat.docController.getRulePool(),scrat.docController&&scrat.docController.his_getMyInfo&&scrat.docController.his_getMyInfo(),scrat.navPara.userProfile.level<scrat.stockEnums.LevelList.ADMIN&&$("#title-nav-bar .dropdown.user .admin").hide();var a=$('<li role="presentation" class="dropdown-header signin title-li">每日签到</li>');$("#title-nav-bar > .user ul .profile").after(a),t.data.has_signed_up_today?(a.text("已签到"+t.data.week_count+"天").addClass("done"),scrat.utility.bindTooltip(a,(3===t.data.level?"一周内签到满4天送2天VIP会员":"一周内签到满4天送7天高级会员")+"， 本周已签到"+t.data.week_count+"天")):a.click(function(){return scrat.utility.ajaxDispatch("POST","/score/signup",!0,null,function(t){t.data.msg&&scrat.utility.addFadeoutPopup($("#fadeout-tips"),t.data.msg,3e3),scrat.navPara.userProfile.score=t.data.score,scrat.navPara.userProfile.week_count=t.data.week_count,a.text("今天已签到").addClass("done").unbind()}),!1}),$(".ring-bell").removeClass("hide"),scrat.utility.fromWechat()||n()})):$("#title-nav-bar .right-side.signup, .right-side.login").removeClass("hide")};scrat.utility.isBelowIE9()&&alert("你使用的浏览器版本过低，请升级浏览器，为获得最好的显示效果建议使用Chrome浏览器。"),scrat.navPara.loginPage=!1,scrat.navPara.sid=scrat.utility.getURLPara("sid"),scrat.navPara.uid=scrat.utility.getURLPara("uid"),(scrat.initial_data||initial_data)&&(scrat.initial_data=JSON.parse((scrat.initial_data||initial_data).replace(/&quot;/g,'"')),initial_data=scrat.initial_data),scrat.initial_data.account&&"null"!==scrat.initial_data.account?$("#title-nav-bar > .mine").show():$("#title-nav-bar > .mine").hide(),$.ajaxSetup({scriptCharset:"utf-8",contentType:"application/json; charset=utf-8"}),s(),i(),$("#title-nav-bar .user-title").click(function(){return scrat.initial_data.account&&"null"!==scrat.initial_data.account?window.open("/user/home"):($("#loginPopCnt").modal("show"),scrat.navPara.urlJump=!0),!1}),$("#title-nav-bar .dropdown.user .title-li").click(function(){return scrat.initial_data.account&&"null"!==scrat.initial_data.account?$(this).hasClass("wallet")?window.open("/payment/wallet"):$(this).hasClass("record")?window.open("/user/record"):$(this).hasClass("setting")?window.open("/user/setting"):$(this).hasClass("profile")?window.open("/user/home"):$(this).hasClass("admin")&&window.open("/admin/home"):($("#loginPopCnt").modal("show"),scrat.navPara.urlJump=!0),!1}),$("#title-nav-bar .user .userLogout").submit(function(){scrat.initial_data.account=null,scrat.utility.clearCookie(scrat.stockEnums.TempStrategyCookieName),window.location.reload()}),$("#title-nav-bar > .login").click(function(){scrat.navPara.loginPage=!0,$("#loginPopCnt").modal("show"),scrat.navPara.urlJump=!1}),$("#title-nav-bar > .signup").click(function(){scrat.navPara.loginPage=!1,$("#loginPopCnt").modal("show"),scrat.navPara.urlJump=!1}),$("#title-cnt .main").click(a),$("#title-logo").click(a),$("#title-nav-bar div.dropdown").mouseover(function(){$(this).addClass("open")}).mouseout(function(){$(this).removeClass("open")}),$("#title-nav-bar .research .title-li").click(function(){return scrat.utility.clearCookie(scrat.stockEnums.TempStrategyCookieName),window.open($(this).hasClass("fund")?"/stock?category=fund":$(this).hasClass("stock")?"/stock?category=stock":$(this).hasClass("asset")?"/stock?category=asset":"/stock/history"),!1}),$("#title-nav-bar .community .dropdown-toggle a").click(function(){return window.open("/forum"),!1}),$("#title-nav-bar .dropdown.trader .title-li").click(function(){return $(this).hasClass("trader")?window.open("/user/home?page=trader"):$(this).hasClass("talk")?window.open(scrat.initial_data.account&&"null"!==scrat.initial_data.account?"/user/home?page=talkall":"/stock/talk"):$(this).hasClass("autoTrader")&&window.open("https://guorn.com/forum/post/p.5.78328934560273"),!1}),$("#title-nav-bar .dropdown.community .title-li").click(function(){return $(this).hasClass("forum")?window.open("/forum"):$(this).hasClass("video")?window.open("/forum/post/p.3.52223555813477?tag=elite"):$(this).hasClass("help")?window.open("/stock/help"):$(this).hasClass("school")?window.open("/stock/school"):$(this).hasClass("vip")&&window.open("/membership/vip"),!1}),$("#title-nav-bar .dropdown.strategies .title-li").click(function(){return $(this).hasClass("free")?window.open("/stock/strategy"):$(this).hasClass("mall-s")?window.open("/stock/mall?type=single"):$(this).hasClass("mall-a")&&window.open("/stock/mall?type=asset"),!1}),$("#title-cnt .about").prop("href",t+"/about"),$("#sign-in-form").hide(),$("#ad-float").find("span.shut").click(function(){$("#ad-float").remove()})});