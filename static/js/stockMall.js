$(document).ready(function(){var t=9,a=1,s="",e=!1,i=0,n=0,r=[],d=[],l=[],c=[],o=[],p=[],h=["annual_return","real_return","quarter_return","month_return","last_day_return","max_withdraw","next_trade_date","mall_date","mall_price"],u=["annual_return","real_return","quarter_return","month_return","last_day_return","mall_date"],g="",m="精选",v="试用",y="热门",_=!1,f="1"===scrat.utility.getURLPara("list"),w=function(){var t=$(window).height();$("#strategy-cnt").css("min-height",t-($("#title-cnt").height()||0)-218),$("#btmCnt").show()},C=function(t,a){t.click(function(t){"A"!==$(t.target).prop("tagName").toUpperCase()&&"circle"!==$(t.target).prop("tagName").toLowerCase()&&window.open("/stock/strategy?sid="+a)})},x=function(){$("#tag-cnt .content span").click(function(){$(this).hasClass("selected")||($("#tag-cnt .content span").removeClass("selected"),$(this).addClass("selected"),g=$(this).text(),"不限"===g&&(g=""),q(1),window.history.pushState({},0,scrat.utility.appendURLPara(decodeURIComponent(window.location.href),"type","single")))})},b=function(t){var a=$("#tag-cnt .content"),s=scrat.utility.getURLPara("tag");a.empty(),g="",s&&""!==s&&(g=s),a.append(""===g?$('<span class="selected">不限</span>'):$("<span>不限</span>"));for(var e=0;e<t.length;e++)if(t[e]!==m&&t[e]!==v&&t[e]!==y){var i=$("<span>"+t[e]+"</span>");g===t[e]&&(i=$('<span class="selected">'+t[e]+"</span>")),a.append(i)}x()},P=function(t){var a,s,e,i,n,r,d,l,c,h,u,g=$(".asset-cnt"),m="",v="定价中",y="待定",_="投资额度:待定";g.empty(),0!==o.length&&(o=[],p=[]);for(var f=0;f<t.length;f++){a=t[f],s=a.annual_return,e=a.max_withdraw,i=a.mall_capacity,n=a.mall_price,r=a.origin_price,d=a.name,l=a.id,m=0!==a.tag.length?a.tag[0]:"精品组合",c=a.next_trade_date,h=a.user_name,u=a.uid,v=1===a.sold_out?"已满":"可订阅",y=n/10,_=i?i:"";var w=$('<div class="chart-cnt"><div class="top"><a class="strategy name" target="_blank" href="/stock/strategy?sid='+l+'">'+d+'</a><span class="strategy status">'+v+'</span><span class="asset-tag">'+m+'</span></div><div class="clear"></div><div id="top-chart-asset'+f+'" class="golden-chart"></div><div class="middle"><div class="small-title">年化收益率</div><div class="small-title max_withdraw">最大回撤</div><div class="small-title capacity right"><span>投资额</span></div><span class="annual">'+s+'</span><span class="max_withdraw">'+e+'</span><span class="capacity right">'+_+'</span></div><div class="bottom"><p class="old-price left"><span class="origin_price">'+6*r/10+'元/半年</span></p><p class="num left"><span>'+6*y+'</span>元/半年</p><span class="button right">详情</span></div></div>');f>0&&(f+1)%3===0&&(w.css("margin-right","0"),w.css("margin-left","0")),scrat.utility.bindTooltip(w.find(".strategy.name"),d),scrat.utility.bindTooltip(w.find(".capacity"),"建议跟随资金额不超过"+i),C(w,l),g.append(w),p.push(a.chart||""),o.push(new scrat.ChartViewer({ID:"#top-chart-asset"+f,hasSlider:!1}))}L(p,o,"goldenChartAsset")},k=function(t){var a,s,e,i,n,r,d,o,p,h,u,g=$(".elite-cnt"),v="",y="定价中",_="投资额度:待定";g.empty(),0!==l.length&&(l=[],c=[]);for(var f=0;f<t.length&&(a=t[f],s=a.annual_return,e=a.quarter_return,i=a.mall_capacity||"",n=a.mall_price||"",r=a.origin_price,d=a.name,o=a.id,v=0!==a.tag.length?a.tag[0]:"精品组合",p=a.next_trade_date,h=a.user_name,u=a.uid,3!==c.length);f++){y=1===a.sold_out?"已满":"可订阅",_="投资额"+(i?i:"");var w=$('<div class="chart-cnt"><div class="top"><a class="strategy name" target="_blank" href="/stock/strategy?sid='+o+'">'+d+'</a><span class="strategy status">'+y+'</span><a class="author name right" target="_blank" href="/user/home?uid='+u+'">'+h+"</a>"+(""===v?'<div class="mytag"><span>暂无</span></div>':'<div class="mytag txt"><span>'+m+"</span></div>")+'</div><div class="clear"></div><div id="top-chart-elite'+f+'" class="golden-chart"></div><div class="middle"><div class="small-title quarter">一季收益率</div><div class="small-title">年化收益率</div><div class="small-title trade-date right">下个调仓日</div><span class="quarter">'+e+'</span><span class="annual">'+s+'</span><span class="trade-date right">'+p+'</span></div><div class="bottom"><div class="old-price"><span><span class="num">'+r/10+'</span>元/月</span></div><div class="capacity">'+_+'</div><span class="button right">详情</span><p class="new-price"><span><span class="num">'+n/10+"</span>元/月</span></p></div></div>");void 0===e&&w.find(".quarter").hide(),(void 0===p||""===p)&&w.find(".trade-date").hide(),f>0&&(f+1)%3===0&&(w.css("margin-right","0"),w.css("margin-left","0")),scrat.utility.bindTooltip(w.find(".strategy.name"),d),scrat.utility.bindTooltip(w.find(".capacity"),"建议跟随资金额不超过"+i),C(w,o),g.append(w),c.push(a.chart||""),l.push(new scrat.ChartViewer({ID:"#top-chart-elite"+f,hasSlider:!1}))}L(c,l,"goldenChartElite")},U=function(t){var a,s,n,l,c,o,p,u,g,m,v,y,w,x,b,P,k=$(".content-chart .chart"),U=$(".content-chart .list tbody"),R="",q="定价中",S="待定",I="投资额度:待定";k.empty(),U.empty(),0!==r.length&&(r=[],d=[]);for(var T=0;T<t.length;T++){a=t[T],s=a.annual_return,n=a.quarter_return,l=a.mall_capacity,c=a.mall_price,o=a.name,p=a.id,R=0!==a.tag.length?a.tag[0]:"",u=a.next_trade_date,u=u.replace(/-/g,"/"),v=a.max_withdraw,y=a.real_return,w=a.last_day_return,b=a.month_return,x=a.mall_date,g=a.user_name,m=a.uid,P=a.avatar||scrat.stockEnums.defaultProfileImg,q=1===a.sold_out?"已满":"可订阅",S=c/10,I="投资额"+(l?l:"");var D=$('<div class="chart-cnt"><div class="top"><a class="strategy name" target="_blank" href="/stock/strategy?sid='+p+'">'+o+'</a><span class="strategy status">'+q+'</span><a class="author name right" target="_blank" href="/user/home?uid='+m+'">'+g+"</a>"+(""===R?'<div class="mytag"><span>暂无</span></div>':'<div class="mytag txt"><span>'+R+"</span></div>")+'</div><div class="clear"></div><div id="top-chart'+T+'" class="golden-chart"></div><div class="middle"><div class="small-title quarter">一季收益率</div><div class="small-title">年化收益率</div><div class="small-title next_trade_date right hide">下个调仓日</div><div class="small-title max_withdraw right hide">最大回撤</div><div class="small-title real_return right hide">实盘收益</div><div class="small-title last_day_return right hide">近一日收益</div><div class="small-title mall_date right hide">上架日期</div><div class="small-title month_return right hide">近一月收益</div><span class="quarter">'+n+'</span><span class="annual">'+s+'</span><span class="next_trade_date right hide">'+u+'</span><span class="max_withdraw right hide">'+v+'</span><span class="real_return right hide">'+y+'</span><span class="last_day_return right hide">'+w+'</span><span class="mall_date right hide">'+x+'</span><span class="month_return right hide">'+b+'</span></div><div class="bottom"><div class="price"><span><span class="num">'+(_?S+100:S)+'</span>元/月</span></div><div class="capacity">'+I+'</div><span class="button right">详情</span><p class="activity"><span class="num">'+S+"</span>元/月</span>&nbsp;&nbsp;(周年庆限时特价)</p></div></div>"),j=$('<tr><td class="strategy_name"><a class="strategy name" target="_blank" href="/stock/strategy?sid='+p+'">'+o+'</a></td><td class="author_name"><img src="'+P+'"><a class="author name right" target="_blank" href="/user/home?uid='+m+'">'+g+'</a></td><td class="annual_return">'+s+'</td><td class="real_return">'+y+'</td><td class="quarter_return">'+n+'</td><td class="month_return">'+b+'</td><td class="last_day_return">'+w+'</td><td class="max_withdraw hide">'+v+'</td><td class="next_trade_date hide">'+u+'</td><td class="mall_date hide">'+x+'</td><td class="mall_capacity hide">'+l+'</td><td class="mall_price hide">'+S+"元/月</td></tr>");void 0===n&&D.find(".quarter").hide(),(void 0===u||""===u)&&D.find(".trade-date").hide(),_&&(D.find(".activity").show(),D.find(".price >span").css("style","{}"),D.find(".price >span").css("color","#626262"),D.find(".price >span").css("text-decoration","line-through"),D.find(".price .num").css("font-size","14px"),D.find(".price").css("margin-top","0")),d.length>0&&(d.length+1)%3===0&&(D.css("margin-right","0"),D.css("margin-left","0")),scrat.utility.bindTooltip(D.find(".strategy.name"),o),scrat.utility.bindTooltip(D.find(".capacity"),"建议跟随资金额不超过"+l),C(D,p),k.append(D),C(j,p),U.append(j),d.push(a.chart||""),r.push(new scrat.ChartViewer({ID:"#top-chart"+T,hasSlider:!1}))}var E,G="next_trade_date",M=["real_return","month_return","last_day_return","max_withdraw","next_trade_date","mall_date"],O="mall_price",A=["max_withdraw","next_trade_date","mall_date","mall_capacity","mall_price"];e?E=h[i]:scrat.utility.getURLPara("order")&&(E=scrat.utility.getURLPara("order")),-1!==A.indexOf(E)&&(O=E);var F=U.parent();F.find("th.sel").addClass("hide"),F.find("."+O).removeClass("hide"),F.find("th").removeClass("selected"),F.find("th."+E).addClass("selected"),-1!==M.indexOf(E)&&(G=E),k.find("."+G).removeClass("hide"),L(d,r,"goldenChart"),f?(k.hide(),U.parent().parent().show()):(U.parent().parent().hide(),k.show())},R=function(t,a,s){scrat.sheetList.currentSheetID=t,s&&(scrat.sheetList.deleteSheet(t),s.sheet_defn.layout.chart.style={dual_axis:!1},scrat.sheetList.addOrUpdateSheetModel(s.sheet_defn,s.sheet_data),a.sheetModel=scrat.sheetList.getSheetModelByID(t),a.sheetModel.stockPara={firstRed:!0,hideAxis:!0,hideAxisName:!0,legendLeft:!0,legendVert:!0},a.empty())},L=function(t,a,s){for(var e=0;e<t.length;e++)""!==t[e]&&null!==a[e]&&(R(s+e,a[e],t[e]),a[e].render())},q=function(r){var d=""===s?"":"&category="+s,l="";if(e===!0)i=$("#sort-cnt .selected").index(".sort-btn"),n=1===$("#sort-cnt .selected .glyphicon-arrow-up").length?1:0,window.history.pushState({},0,scrat.utility.appendURLPara(decodeURIComponent(window.location.href),"order",h[i])),window.history.pushState({},0,scrat.utility.appendURLPara(decodeURIComponent(window.location.href),"asc",n)),l="&order="+h[i]+"&asc="+n;else{var c,o=scrat.utility.getURLPara("order");null!==o&&(i=h.indexOf(o),$("#sort-cnt .selected").removeClass("selected"),c=$("#sort-cnt .sort-btn:eq("+i+")"),c.addClass("selected"),c.find(".glyphicon").remove(),c.append($('<span class="glyphicon '+("1"===scrat.utility.getURLPara("asc")?"glyphicon-arrow-up":"glyphicon-arrow-down")+'"></span>')),l="&order="+scrat.utility.getURLPara("order")+"&asc="+scrat.utility.getURLPara("asc"))}""!==g?window.history.pushState({},0,scrat.utility.appendURLPara(decodeURIComponent(window.location.href),"tag",g)):scrat.utility.getURLPara("tag")&&window.history.pushState({},0,scrat.utility.delURLPara(decodeURIComponent(window.location.href),"tag")),scrat.utility.ajaxDispatch("GET","/stock/mall?fmt=json&size="+t+"&page="+r+d+l+(""===g?"":"&tag="+g),!0,null,function(e){var i=Math.ceil(e.data.total_count/t);a=Math.min(i,r),0>=i?$(".pagination").hide():($.jqPaginator(".pagination",{totalPages:i,currentPage:a,onPageChange:function(t){t!=a&&(a=t,q(t,s))}}),$(".pagination").show()),b(e.data.tag_list),U(e.data.strategy_list)})},S=function(){var t=$("#bind-wechat-dialog"),a=function(){scrat.utility.ajaxDispatch("GET","/user/profile?uid="+scrat.navPara.userProfile.uid,!1,null,function(s){s.data.wechat_name?(t.modal("hide"),scrat.utility.addFadeoutPopup($("#fadeout-tips"),"恭喜您，成功绑定果仁微信！",5e3)):"none"!==$("#bind-wechat-dialog").css("display")&&setTimeout(function(){a()},1e3)})};return scrat.navPara.userProfile?""!==scrat.navPara.userProfile.wechat_name?void scrat.utility.addFadeoutPopup($("#fadeout-tips"),"您已经绑定过果仁微信",5e3):(t.find(".modal-body > div").hide(),scrat.utility.ajaxDispatch("GET","/wechat/qr",!0,null,function(t){$("#bind-wechat-body img.qrcode")[0].src=t.data.url}),$("#bind-wechat-body").show(),t.modal("show"),void a()):void scrat.utility.addFadeoutPopup($("#fadeout-tips"),"请您登陆后再点击绑定果仁微信",3e3)},I=function(t){$(".nav-tabs li").removeClass("active"),$(".nav-tabs li:eq("+t+")").addClass("active"),$(".cnts").addClass("hide"),$(".cnts:eq("+t+")").removeClass("hide")},T=function(){scrat.utility.ajaxDispatch("GET","/stock/mall/report",!1,null,function(t){var a,s,e,i=t.data.rank_list,n=t.data.month,r=$(".right-cnt .statistic");r.find("img.title")[0].src="/static/images/mall_statistic"+n+".png",s=r.find(".content"),s.empty();for(var d=0;d<i.length;d++)a=i[d],e=$('<p><a target="_blank" href="/stock/strategy?sid='+a.strategy_id+'">'+a.strategy_name+'</a>：<span class="num">'+(100*a.month_return).toFixed(2)+"%</span></p>"),s.append(e)})};scrat.sheetList=new scrat.SheetList({}),scrat.utility.ajaxDispatch("GET","/stock/mall?fmt=json&category=asset",!0,null,function(t){P(t.data.strategy_list),w()}),scrat.utility.ajaxDispatch("GET","/stock/mall?fmt=json&tag="+m,!0,null,function(t){k(t.data.strategy_list)}),q(1),T(),$("#type-cnt .content span").click(function(){$(this).hasClass("selected")||($("#type-cnt .content span").removeClass("selected"),$(this).addClass("selected"),s=$(this).hasClass("stock")?"stock":$(this).hasClass("fund")?"fund":$(this).hasClass("asset")?"asset":"",q(1))}),$("#sort-cnt .sort-btn").click(function(){e=!0,$(this).parent().find(".sort-btn").removeClass("selected"),$(this).addClass("selected"),i=$("#sort-cnt .sort-btn.selected").index(".sort-btn");var t=h[i],a=0!==$(this).find(".glyphicon-arrow-up").length||-1!==u.indexOf(t)&&0===$(this).find(".glyphicon").length;$(this).parent().find(".sort-btn span.glyphicon").remove(),$(this).append('<span class="glyphicon '+(a?"glyphicon-arrow-down":"glyphicon-arrow-up")+'"></span>'),q(1),window.history.pushState({},0,scrat.utility.appendURLPara(decodeURIComponent(window.location.href),"type","single"))});var D=function(){var t=$("#sort-cnt");t.find("span.mode").removeClass("selected"),f?(t.find("span.mode.list").addClass("selected"),$(".content-chart .chart").hide(),$(".content-chart .list").show()):(t.find("span.mode.pic").addClass("selected"),$(".content-chart .list").hide(),$(".content-chart .chart").show())};$("#sort-cnt span.mode").click(function(){$(this).hasClass("selected")||(f=$(this).hasClass("list"),D(),window.history.pushState({},0,scrat.utility.appendURLPara(decodeURIComponent(window.location.href),"list",f?1:0)))}),D(),$(".clickToWechat").click(S),$(".nav-tabs li").click(function(){if(!$(this).hasClass("active")){var t=["single","asset"],a=$(this).index();I(a),window.history.pushState({},0,scrat.utility.appendURLPara(decodeURIComponent(window.location.href),"type",t[a]))}});var j=scrat.utility.getURLPara("type");I("asset"===j?1:0)});